const $=e=>document.querySelector(e),$All=e=>document.querySelectorAll(e),handleClickPrev=(e,t)=>{e.addEventListener("click",e=>{e.preventDefault(),t(e)})},customScrollTo=(e,t)=>{const a=e-0;let n=0;const i=()=>{const e=easeInOutQuad(n+=20,0,a,t);window.scrollTo(0,e),n<t&&setTimeout(i,20)};i()},easeInOutQuad=(e,t,a,n)=>(e/=n/2)<1?a/2*e*e+t:-a/2*(--e*(e-2)-1)+t,browser=function(){const e=function(e){return e.test(window.navigator.userAgent)};switch(!0){case e(/edg/i):return"Microsoft Edge";case e(/trident/i):return"Microsoft Internet Explorer";case e(/firefox|fxios/i):return"Mozilla Firefox";case e(/opr\//i):return"Opera";case e(/ucbrowser/i):return"UC Browser";case e(/samsungbrowser/i):return"Samsung Browser";case e(/chrome|chromium|crios/i):return"Google Chrome";case e(/safari/i):return"Apple Safari";default:return"Other"}}();let state={gameAnimDelay:!1,gameAnimDelayTime:3500,markALinkTogglerText:!1,winDataIndex:Math.floor(10*Math.random())+1,isGameFinished:!1,gameTimer:null,gameRef:null,aboutRef:null,casesRef:null,plansRef:null,shouldRetype:!0,isWeakBrowser:"Apple Safari"===browser,isMusicStarted:!1,isMusicPlaying:!1};const gameToggleBtn=$(".gameToggleBtn"),gameSection=$(".game-unique"),toggleText=$All(".game__text"),gameCellsUniq=$All(".game__field-unique .game__cell_wrap"),gameTyping=$All(".gameTyping"),aboutTyping=$All(".aboutTyping"),audio=$("audio"),audioBtn=$(".audio_controls"),startMusic=()=>{if(state.isMusicStarted)return;const e=audio.play();void 0!==e&&e.then(()=>{state={...state,isMusicStarted:!0,isMusicPlaying:!0},$(".logo_section").classList.add("logo_section-transparent"),$(".finale__special").classList.remove("finale__special-disabled"),audioBtn.classList.add("audio_controls-pause","audio_controls-active"),setTimeout(()=>{audioBtn.classList.remove("audio_controls-active")},1e3)}).catch(e=>{console.log(e)})},toggleMusic=()=>{state.isMusicPlaying?audio.pause():(audio.play(),$(".finale__special").classList.remove("finale__special-disabled")),state={...state,isMusicPlaying:!state.isMusicPlaying},audioBtn.classList.toggle("audio_controls-pause")},handleMusic=()=>{audioBtn.classList.remove("audio_controls-active"),handleClickPrev(audioBtn,toggleMusic)},handleGameToggleClick=()=>{const e=state.markALinkTogglerText?"OFF":"ON";toggleText.forEach(t=>t.textContent=e),gameSection.classList.toggle("success"),state={...state,markALinkTogglerText:!state.markALinkTogglerText},toggleGameField(state.markALinkTogglerText)},toggleGameField=e=>{$All(".game__cell_wrap").forEach(t=>{if(e){t.getAttribute("data-index")!=state.winDataIndex&&t.classList.add("game__cell_wrap-hide")}else t.classList.remove("game__cell_wrap-hide")})};handleClickPrev(gameToggleBtn,handleGameToggleClick),gameCellsUniq.forEach(e=>{e.addEventListener("mouseenter",e=>{const t=e.currentTarget.getAttribute("data-index");$All(`.game__cell_wrap[data-index="${t}"]`).forEach(e=>e.classList.add("game__cell_wrap-hover")),animateGameGlitch()}),e.addEventListener("mouseleave",e=>{e.currentTarget.getAttribute("data-index");$All(".game__cell_wrap-hover").forEach(e=>e.classList.remove("game__cell_wrap-hover")),state.gameTimer&&(clearTimeout(state.gameTimer),state={...state,gameTimer:null}),makeGameGlitchAvail()})});const rightAnswer=e=>{$All(`.game__cell_wrap[data-index="${e}"]`).forEach(e=>{e.classList.add("game__cell_wrap-right")}),state={...state,isGameFinished:!0},initTyping(gameTyping,"Success!","gameRef",!0),state.markALinkTogglerText&&handleGameToggleClick(),$All(".gameTyping").forEach(e=>e.setAttribute("data-text","Download MarkALink")),setTimeout(()=>{initTyping($All(".gameTyping"),"Download MarkALink","gameRef",!0)},5e3)},wrongAnswer=e=>{const t=$All(`.game__cell_wrap[data-index="${e}"]`);initTyping(gameTyping,"Wrooooong!","gameRef",!0),t.forEach(e=>{e.classList.add("game__cell_wrap-wrong"),setTimeout(()=>{e.classList.remove("game__cell_wrap-wrong")},3e3)})},cellClick=e=>{if(state.isGameFinished)return;const t=e.currentTarget.getAttribute("data-index");t==state.winDataIndex?rightAnswer(t):wrongAnswer(t),startMusic()},initGame=()=>{$All(".game__cell_wrap").forEach(e=>handleClickPrev(e,cellClick))};$All(".game__cell_wrap").forEach(e=>handleClickPrev(e,cellClick));const initTyping=(e,t="",a,n=state.shouldRetype)=>{if(!n&&Boolean(state[a])||state.isWeakBrowser)return;let i=0;const s=()=>{i<t.length?(e.forEach(e=>e.textContent+=t.charAt(i)),i++," "==t.charAt(i)?s():state={...state,[a]:setTimeout(s,100)}):(clearTimeout(state[a]),state={...state,[a]:null})};state[a]&&(clearTimeout(state[a]),state={...state,[a]:null}),e.forEach(e=>e.textContent=""),s()},animateAboutLinks=()=>{$All(".about__link").forEach(e=>{e.addEventListener("mouseenter",e=>{e.currentTarget.parentNode.parentNode.parentNode.classList.add("glitch_hover_text-no_anim")}),e.addEventListener("mouseleave",e=>{e.currentTarget.parentNode.parentNode.parentNode.classList.remove("glitch_hover_text-no_anim")})})};setTimeout(animateAboutLinks,10);const animateOnStart=()=>{const e=window.location.hash.substr(1);if(!e)return;const t=$(`.${e}`);if(!t)return;const a=window.pageYOffset+t.getBoundingClientRect().top;customScrollTo(a,Math.floor(a/2))},animateGameGlitch=()=>{if(state.gameAnimDelay)return;const e=Math.random()<.5?"anim-1":"anim-2";gameSection.classList.add(e),state={...state,gameAnimDelay:!0},makeGameGlitchAvail()},makeGameGlitchAvail=()=>{state={...state,gameTimer:setTimeout(()=>{gameSection.classList.remove("anim-1","anim-2"),state={...state,gameAnimDelay:!1}},state.gameAnimDelayTime)}},animateSectionMulti=e=>{e.classList.add("section_to_animate-animated"),e.classList.add("stateAnimated"),setTimeout(()=>{e.classList.remove("section_to_animate-animated")},2400)},animateSectionOnce=e=>{e.classList.add("section_to_animate-animated")},animateSection=e=>{if(e.classList.contains("stateAnimated"))return;const t=e.querySelector(".typing");if(t){const a=t.getAttribute("data-ref"),n=t.getAttribute("data-text"),i=e.querySelectorAll(".typing");initTyping(i,n,a,state.shouldRetype)}e.classList.contains("game")?setTimeout(animateGameGlitch,500):e.classList.contains("about")?setTimeout(()=>{animateSectionMulti(e)},500):e.classList.contains("finale")?setTimeout(()=>{animateSectionOnce(e)},300):e.classList.contains("cases")&&setTimeout(()=>{animateSectionMulti(e)},500)},deAnimateSection=e=>{const t=e.querySelector(".typing");if(t){const e=t.getAttribute("data-ref"),a=t.getAttribute("data-text");t.textContent=a,clearTimeout(state[e]),state={...state,[e]:setTimeout(()=>{state={...state,[e]:null}},3e3)}}setTimeout(()=>{const t=new IntersectionObserver((a,n)=>{for(const t of a){t.isIntersecting||e.classList.remove("stateAnimated")}t.disconnect()},{threshold:.05});t.observe(e)},7e3)},animateOnScroll=()=>{const e=new IntersectionObserver((e,t)=>{for(const t of e){const e=t.isIntersecting,a=t.target;e?animateSection(a):deAnimateSection(a)}},{threshold:.05});for(const t of $All(".section_to_animate"))e.observe(t)},watchForSections=()=>{let e=null,t=null;const a=new IntersectionObserver((e,a)=>{for(const a of e){const e=a.isIntersecting,n=a.target;t=e?n:null}},{threshold:.95});for(const e of $All(".sectionHeightWatch"))a.observe(e);window.addEventListener("scroll",()=>{null!==e&&clearTimeout(e),e=setTimeout(()=>{t&&t.scrollIntoView({behavior:"smooth"})},500)},!1)},initSlider=()=>{if(document.querySelectorAll(".slider-script").length>0)return void window.dispatchEvent(new Event("resize"));const e=document.getElementsByTagName("head")[0],t=document.createElement("link");t.href="https://unpkg.com/swiper/swiper-bundle.min.css",t.rel="stylesheet",t.type="text/css",t.media="all",e.appendChild(t),t.onload=(()=>{const t=document.createElement("link");t.href="css/slider.css",t.rel="stylesheet",t.type="text/css",t.media="all",e.appendChild(t)});const a=document.createElement("script");a.src="https://unpkg.com/swiper/swiper-bundle.min.js",document.body.appendChild(a),a.onload=(()=>{const e=document.createElement("script");e.src="js/slider.js",e.className="slider-script",document.body.appendChild(e)})},watchSlider=()=>{const e=new IntersectionObserver((e,t)=>{for(const t of e){t.isIntersecting&&initSlider()}},{threshold:.45});for(const t of $All(".lazyLoadSwiper"))e.observe(t)},watchFullScreen=()=>{window.addEventListener("resize",()=>{var e=window.screen.height,t=window.screen.width,a=window.innerHeight;t==window.innerWidth&&e==a?(document.documentElement.classList.add("full_screen"),startMusic()):document.documentElement.classList.remove("full_screen")})},initClickOnLogo=()=>{if(window.screen.availWidth<=1024)return void $(".logo_capt").remove();const e=$(".logo_wrap"),t=document.documentElement;handleClickPrev(e,()=>{startMusic(),(()=>document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.webkitCurrentFullScreenElement)()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()})},initPassiveInteractive=()=>{animateOnStart(),animateOnScroll(),watchForSections(),window.addEventListener("resize",()=>{var e=window.screen.height,t=window.screen.width,a=window.innerHeight;t==window.innerWidth&&e==a?(document.documentElement.classList.add("full_screen"),startMusic()):document.documentElement.classList.remove("full_screen")}),watchSlider(),initClickOnLogo(),audioBtn.classList.remove("audio_controls-active"),handleClickPrev(audioBtn,toggleMusic),setTimeout(()=>{state={...state,shouldRetype:!1}},3e3)};window.addEventListener("load",()=>{setTimeout(initPassiveInteractive,10)},!1);
